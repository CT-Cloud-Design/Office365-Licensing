function newDivider(){const e=document.createElement("div");return e.className="divider",e}function newActions(){const e=document.createElement("div");return e.className="actions",e}function newHeader(){const e=document.createElement("h2");return e}function newDiagramLink(e,t){const n=document.createElement("a");return n.className="diagram",n.text=e,n.href=t,n}function newPngLink(){const e=document.createElement("a");return e.href="#",e.className="export",e.title="Export PNG",e.text="PNG",e}function newSvgLink(){const e=document.createElement("a");return e.href="#",e.className="export",e.title="Export SVG",e.text="SVG",e}function newDeleteImage(){const e=document.createElement("img");return e.src="/media/delete.svg",e.width=16,e.height=16,e.alt="Delete",e.title="Delete",e.className="delete",e}function newRenameImage(){const e=document.createElement("img");return e.src="/media/edit-off.svg",e.width=16,e.height=16,e.alt="Rename",e.title="Rename",e.className="rename",e}function addEmptyMessage(e){const t=document.createElement("h2");t.innerText="There are no saved diagrams.",e.appendChild(t)}function addNewRow(e,t,n){const i=newHeader(),o=newDiagramLink(n.Title,"/viewsvg.htm#*"+t);i.appendChild(o),e.appendChild(i);const a=newActions(),l=newRenameImage();a.appendChild(l);const d=newDivider();l.addEventListener("click",function(){const e=customPrompt("Rename saved diagram:",o.textContent);if(e){n.Title=e;const i=JSON.stringify(n);localStorage.setItem(t,i),o.textContent=e,isIE&&fixToMaxItemWidth("diagram",20,!0)}});const r=newDeleteImage();if(a.appendChild(r),r.addEventListener("click",function(){const n='Are you sure you want to delete "'+o.textContent+'"?';customConfirm(n)&&(localStorage.removeItem(t),e.removeChild(i),e.removeChild(a),e.removeChild(d),0===e.getElementsByTagName("h2").length&&(e.innerHTML="",e.appendChild(newDivider()),addEmptyMessage(e),e.appendChild(newDivider())))}),!isIOSEdge){const e=newSvgLink();a.appendChild(e),e.addEventListener("click",function(e){e.preventDefault(),exportSvg(n.Title+".svg",n.SvgXml)})}if(!isIOSEdge&&!isIE){const e=newPngLink();a.appendChild(e),e.addEventListener("click",function(e){e.preventDefault();const t=window.getComputedStyle(document.body).backgroundColor;exportPng(n.Title+".png",n.SvgXml,t)})}e.appendChild(a),e.appendChild(d)}function populateList(){const e=document.getElementById("collection");e.innerHTML="",e.appendChild(newDivider());let t=[];for(let e=0;e<localStorage.length;e+=1){const n=localStorage.key(e);n!==StoreName.Flags&&n!==StoreName.Settings&&t.push(n)}t=t.sort(function(e,t){return parseInt(e)-parseInt(t)});for(let n=0;n<t.length;n+=1){const i=t[n],o=localStorage.getItem(i);if(o){const t=JSON.parse(o);t&&addNewRow(e,i,t)}}0===t.length?(addEmptyMessage(e),e.appendChild(newDivider())):isIE&&fixToMaxItemWidth("diagram",20,!1)}function filesSelected(e){const t=new FileReader,n=e.target.files;for(let e=0;e<n.length;e++){const i=n[e];t.addEventListener("load",function(e){let t=i.name;if(t=customPrompt("Import diagram as:",t),t){const n=Date.now().toString(),i={Title:t,SvgXml:e.target.result},o=JSON.stringify(i);localStorage.setItem(n,o);const a=document.getElementById("collection");addNewRow(a,n,i)}}),t.readAsText(i)}const i=document.getElementById("fileSelector");i.value=""}function exportAllDiagrams(e){const t=document.getElementsByClassName("export");for(let n=0;n<t.length;n++){const i=t[n];i.textContent===e&&simulateClick(i)}}function exportAllDiagramsSvg(){exportAllDiagrams("SVG")}function exportAllDiagramsPng(){exportAllDiagrams("PNG")}function importDiagram(){const e=document.getElementById("fileSelector");simulateClick(e)}function appOffline(){document.getElementById("offline").style.display="block"}function appOnline(){document.getElementById("offline").style.display="none"}function pageLoad(){populateList();const e=document.getElementById("exportAllPng");isIE||isIOS?e.style.display="none":e.addEventListener("click",exportAllDiagramsPng);const t=document.getElementById("exportAllSvg");isIOS?t.style.display="none":t.addEventListener("click",exportAllDiagramsSvg),document.getElementById("import").addEventListener("click",importDiagram),document.getElementById("fileSelector").addEventListener("change",filesSelected),document.getElementById("offline").style.display=navigator.onLine?"none":"block",window.addEventListener("offline",appOffline),window.addEventListener("online",appOnline)}registerServiceWorker(),window.addEventListener("load",pageLoad),loadSettings(),setTheme(Settings.Theme),addThemeListener(themeChange);